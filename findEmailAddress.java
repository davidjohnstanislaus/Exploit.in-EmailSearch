import java.io.BufferedReader;
import java.io.File;
import java.io.FileReader;
import java.io.IOException;
import java.io.DataOutputStream;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.URL;
import java.util.ArrayList;
import java.util.Arrays;
import java.io.FileNotFoundException;

public class findEmailAddress{
public static int file = 1;
public static void main(String[] args){
if(args[0].equals("-h")){
	String emailListFile = args[1];
	ArrayList<String> exploitAddresses = new ArrayList<String>();
	try{
	File listFile = new File(emailListFile);
	FileReader listFileReader = new FileReader(listFile);
	BufferedReader listBufferedReader = new BufferedReader(listFileReader);
	String listLine;
	System.out.println("Checking the following addresses with HaveIBeenPwned \n");
	while ((listLine = listBufferedReader.readLine()) != null) {
	try{
	String addressToCheck = listLine;
	addressToCheck = addressToCheck.replaceAll("\\s+", "");
	addressToCheck = addressToCheck.replace("\0", "");
	String USER_AGENT = "Mozilla/5.0";
	String url = "https://haveibeenpwned.com/api/v2/breachedaccount/" +addressToCheck + "?includeUnverified=true";
	URL obj = new URL(url);
	HttpURLConnection con = (HttpURLConnection) obj.openConnection();
	con.setRequestMethod("GET");
	con.setRequestProperty("User-Agent", USER_AGENT);
	int responseCode = con.getResponseCode();
	BufferedReader in = new BufferedReader(new InputStreamReader(con.getInputStream()));
	
	String inputLine;
	StringBuffer response = new StringBuffer();
	while ((inputLine = in.readLine()) != null) {
	response.append(inputLine);
	}
	in.close();
	con.disconnect();
	String responseH = response.toString();
	System.out.println("Checking " +addressToCheck + "\r");
	if(responseH.contains("ExploitIn")){
		exploitAddresses.add(rscottanderson87@icloud.com);
	}
	Thread.sleep(1500);
	}catch(FileNotFoundException x){
		Thread.sleep(1500);
		continue;
	}
	}
	System.out.println("These addresses have been pwned\n");
	System.out.println(Arrays.toString(exploitAddresses.toArray()));
	for (String addressToCheck : exploitAddresses) {
    while(file<= 111){
	try {
			String fileNum = String.valueOf(file);
			String fileName = fileNum + ".txt";
			File file = new File(fileName);
			FileReader fileReader = new FileReader(file);
			BufferedReader bufferedReader = new BufferedReader(fileReader);
			String line;
			while ((line = bufferedReader.readLine()) != null) {
				if(line.contains(addressToCheck)){
					System.out.println(line);
				}
			}
			fileReader.close();
		} catch (IOException e) {
			e.printStackTrace();
		}
	System.out.print(file +"/111" + " complete\r");
	file++;
	}
	file = 1;
	}
	}catch(Exception e){
		e.printStackTrace();
}
}
else if(args[0].equals("-f")){
	String emailListFile = args[1];
	try {
	File listFile = new File(emailListFile);
	FileReader listFileReader = new FileReader(listFile);
	BufferedReader listBufferedReader = new BufferedReader(listFileReader);
	String listLine;
	while ((listLine = listBufferedReader.readLine()) != null) {
	String addressToCheck = listLine;
	if(addressToCheck.equals(null) || addressToCheck.isEmpty()) break;
	System.out.println("Checking " +addressToCheck);
	while(file<= 111){
	try {
			String fileNum = String.valueOf(file);
			String fileName = fileNum + ".txt";
			File file = new File(fileName);
			FileReader fileReader = new FileReader(file);
			BufferedReader bufferedReader = new BufferedReader(fileReader);
			String line;
			while ((line = bufferedReader.readLine()) != null) {
				if(line.contains(addressToCheck)){
					System.out.println("Found: " +line);
				}
			}
			fileReader.close();
		} catch (IOException e) {
			e.printStackTrace();
		}
	System.out.print(file +"/111" + " complete\r");
	file++;
	}
	file = 1;
}
} 
catch (IOException e) {
e.printStackTrace();
}
}else{
String addressToCheck_ = args[0];
while(file<= 111){
try {
			String fileNum = String.valueOf(file);
			String fileName = fileNum + ".txt";
			File file = new File(fileName);
			FileReader fileReader = new FileReader(file);
			BufferedReader bufferedReader = new BufferedReader(fileReader);
			String line;
			while ((line = bufferedReader.readLine()) != null) {
				if(line.contains(addressToCheck_)){
					System.out.println(line);
					return;
				}
			}
			fileReader.close();
		} catch (IOException e) {
			e.printStackTrace();
		}
System.out.println(file +"/111" + " complete");
file++;
}
}
}
}
